/*! optimus v0.1.0 Built at 2022-12-29 15:00 EST */
angular.module("home",["config","spinner","dropdowns","stickyStack","escape","oolCookie","userService","webdvrResource","modal","escape","homeModules","preferences","alertBanner","ctaArrowLink","map","isDeviceWidth","billpayWidget","onetCookies","formSSOService","serviceLevelsService"]).controller("HomeCtrl",["$rootScope","$scope","$timeout","Config","ooluser","User","Preferences","isDeviceWidth","Cookies","FormSSO","ServiceLevels",function(a,b,c,d,e,f,g,h,i,j,k){function l(){s(p)===q.Blue?b.supportAppImage=r.Blue:s(p)===q.Purple?b.supportAppImage=r.Purple:s(p)===q.Teal?b.supportAppImage=r.Teal:s(p)===q.Orange?b.supportAppImage=r.Orange:s(p)===q.Yellow?b.supportAppImage=r.Yellow:s(p)===q.Green&&(b.supportAppImage=r.Green)}e.tv&&void 0===e.tv.numChannels&&(e.tv.numChannels=300),e.internet&&void 0===e.internet.devices&&(e.internet.devices=10),b.type="hotspots";var m=this;m.activeServiceDrawer="",m.myServices=[],m.basePhoneMenuUrl="",m.showSettings={tv:!1,phone:!1,internet:!1},m.isLaBoxUser=e.hasOOLSession?e.laBoxUser||e.laboxOrMini:"true"===i.getCookie("labox"),m.routerLink="/internet/manage-router",m.isStream=e.hasOOLSession?e.internet&&e.internet.stream:"stream"===i.getCookie("eqType"),m.isWestUser=e.hasOOLSession?e.isWestUser:!1,m.isAlarm=e.hasOOLSession?i.getCookieObject("alarmdata"):!1,m.accountInfo={isTV:!1,isInternet:!1,isAlarm:m.isAlarm&&(m.isAlarm.primary||null!==m.isAlarm.role)?!0:!1,hasManagedEquip:!1,isWifiActive:!1,isOOLUpg:!1,hasStream:m.isStream,wifiLAN:{hasMangedEquip:!1,managedTogether:!1,gateway:"",name:"",wpaPassphrase:"",name_5Hz:"",wpaPassphrase_5Hz:"",isXtendAvail:0}},m.masked_pwd="&#x25CF;&#x25CF;&#x25CF;&#x25CF;&#x25CF;&#x25CF;&#x25CF;&#x25CF;&#x25CF;&#x25CF;",m.isLoginInprogress=!1;var n,o,p=$(".global-header").css("background-color"),q={Blue:"#19bce4",Purple:"#aa50aa",Teal:"#43d1b9",Orange:"#f58921",Green:"#a8d228",Yellow:"#f8bc00"},r={Blue:"optimum-app_blue",Purple:"optimum-app_purple",Teal:"optimum-app_teal",Orange:"optimum-app_orange",Green:"optimum-app_green",Yellow:"optimum-app_yellow"},s=function(a){if("#"===a.substr(0,1))return a;var b=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(a),c=parseInt(b[2],10),d=parseInt(b[3],10),e=parseInt(b[4],10),f=e|d<<8|c<<16,g="";return g=f.toString(16),0===c&&(g="00"+g),g=b[1]+"#"+g};l(),b.ooluser=e,m.musActive=!1,e.hasOOLSession&&null!==e.p&&(emailPresent=e.p.email,m.musActive="active"===e.p.mus||"hold"===e.p.mus?!0:!1);var t=["cart","dvr","onDemand","voiceMail","webMail","myServices","wifiUsage"];m.configs={},m.scrollToNextSection=function(a){var b="#"+a,c=$(b).offset().top-$("#header-wrapper").height();$("html,body").animate({scrollTop:c},"slow")},m.scrollToNextSectionMobile=function(a){var b="#"+a,c=$(b).offset().top;$("html,body").animate({scrollTop:c},"slow")},m.isTablet=h.tablet||/\bSilk\b/.test(navigator.userAgent),m.phoneFooterUpsellShow=!0,m.configs.criticalErrorConfig={type:"major",message:"We're sorry, you need to be behind a modem to create an Optimum ID"};var u=2500;m.currentLoggedInUser={corpId:"",hasSession:!1,optimumId:"",inbox:[],hasService:{internet:!1,phone:!1,tv:!1,dvr:!1}},m.userInput={homeLoginForm:{remember:!1,isNotValidOptimumId:!1,isNotValidPassword:!1}},m.activeModules={},m.model={faqSearchText:""};var v=function(){if(m.isTablet){var a=$("#sticky-container").css("background-color");$(".common-footer-links").css("padding","20px 0px 100px 0px"),$(".local-footer").css("background-color",a)}},w=function(){$.each(t,function(a,b){m.activeModules[b]=!1})},x=function(){w(),B(),z()},y=function(a,b){var c=a?a:m.moduleDefaults.shift(),d=b?b:m.moduleDefaults.shift();for("webMail"!==c||m.musActive||(c="myServices"),"webMail"!==d||m.musActive||(d="myServices");c===d&&m.moduleDefaults.length>0;)a?d=m.moduleDefaults.shift():c=m.moduleDefaults.shift();m.moduleDefaults.length?(d||(console.debug("No services available to populate right module, using default: webMail",m.currentLoggedInUser.hasService),m.moduleDefaults.right="webMail"),c||(console.debug("No services available to populate left module, using default: wifiUsage",m.currentLoggedInUser.hasService),m.moduleDefaults.left="wifiUsage")):(console.debug("no defaults found for this user (disco'd), explicitly set defaults to  wifiUsage(L) / webMail(R)"),c="wifiUsage",d="webMail"),"undefined"!==reporting&&(reporting.setAttrs({prop8:c+"|"+d},!0),reporting.pageLoadAfter()),m.activeModules[c]="left",m.activeModules[d]="right"},z=function(){g.getModules().then(function(a){y(a.data.left,a.data.right)},function(){y()})},A=function(){var a=m.currentLoggedInUser;e.hasOOLSession&&(a.isPrimary=e.primary,a.hasSession=!0,a.optimumId=e.optimumId,a.corpId=e.corpId||"",a.hasService={internet:e.ool,phone:e.ov,tv:e.io,dvr:e.p?e.p.dvr&&1===e.p.dvr?!0:!1:!1})},B=function(){var a=m.currentLoggedInUser.hasService,b=[{module:"wifiUsage",service:"internet"},{module:"webMail",service:"internet"},{module:"myServices",service:"internet"},{module:"voiceMail",service:"phone"},{module:"dvr",service:"dvr"},{module:"onDemand",service:"tv"}];console.log("modules :: ",b),m.moduleDefaults=_.map(_.filter(b,function(b){return a[b.service]}),function(a){return a.module})},C=function(a){var b=$("#"+a+"OptimumId").val(),c=$("#"+a+"Password").val();angular.isString(b)&&(b.match(/^\s+/)||b.match(/\s+$/))&&$("#"+a+"OptimumId").val(b=b.replace(/^\s+/,"").replace(/\s+$/,"")),angular.isString(c)&&(c.match(/^\s+/)||c.match(/\s+$/))&&$("#"+a+"Password").val(c=c.replace(/^\s+/,"").replace(/\s+$/,""));var d={isValidId:!1,isValidPassword:!1,optimumId:b,password:c};return""!==d.optimumId&&(d.isValidId=!0),""!==d.password&&(d.isValidPassword=!0),d};m.faqSearch=function(){"undefined"!==reporting&&reporting.trackClick(this,"Home - FAQ Search - "+m.model.faqSearchText),window.location="/FAQ#/list/kw/"+m.model.faqSearchText},m.closePhoneStickyFooter=function(){document.getElementById("local-phone-sticky-footer").className="phone-footer1",m.phoneFooterShow=!1},m.closePhoneUpsellStickyFooter=function(){document.getElementById("local-phone-upsell-sticky-footer").className="phone-footer1",m.phoneFooterUpsellShow=!1},m.loginUser=function(a){m.isLoginInprogress=!0;var b=C(a);if(b.isValidId&&b.isValidPassword)$("#"+a).attr("action",m.loginAction),document.cookie="unsanitizeId="+b.optimumId+";path=/;",$("#"+a).submit();else{var c=m.userInput[a];b.isValidId?b.isValidPassword||(c.isNotValidOptimumId=!1,c.isNotValidPassword=!0):(c.isNotValidOptimumId=!0,c.isNotValidPassword=!1),m.isLoginInprogress=!1}},m.toggleUserInputRemember=function(a){m.userInput[a].remember=!m.userInput[a].remember},m.retrieveTopRightAdUrl=function(a){return e.hasOOLSession?"es"===a?"api/profilecache-parent/services/v1/targetedmessaging/gpt/targetedad/targeted.optimum.espanol/home_top/right":"api/profilecache-parent/services/v1/targetedmessaging/gpt/targetedad/targeted.optimum/home_top/right":""},b.$on("moduleEvent",function(a,b){var c;if("module-select"===b.eventName){var d=m.activeModules,e={};c=d[b.oldModule],d[b.oldModule]=!1,d[b.newModule]=c;for(var f in d)"left"===d[f]?e.homeFunc1=f:"right"===d[f]&&(e.homeFunc2=f);"undefined"!==reporting&&(reporting.setAttrs({prop28:e.homeFunc1+"|"+e.homeFunc2},!0),reporting.setEvents(["event15","event16"]),reporting.sendAttrs(!0)),g.setModules(e).then(function(){console.log("successfully set module preferences")},function(){console.error("Error (Preferences Service) could not set module preferences")})}}),a.$on("webmailDetailsResponse",function(a,b){m.webMail=b}),a.$on("optimumEmailOptInResponse",function(a,b){m.imsEmailResponse=b.imsEmailResponse}),m.checkIsBehindTheModem=function(){var a=!1;o.getIsBehindAnyModem().then(function(b){b.data&&b.data.AccountNo&&(a=!0)}),a?window.location="/profile/create-optimum-id":(m.notBehindModemAlert=!0,c(function(){m.notBehindModemAlert=!1},u))};var D=function(){if(m.isBusinessAccount=e.p.biz&&1===e.p.biz,e.tv&&void 0===e.tv.numChannels&&(e.tv.numChannels=300),e.hasOOLSession){if(e.ool){var a="";m.myServices.push({serviceName:"Internet",serviceLevel:"Optimum Internet",serviceDetail:""}),k.retrieveInternetServiceLevel(e.internet.pkg).then(function(b){if(b.data&&""!==b.data){var c=b.data[0];a+="<b>Download speeds up to "+c.down.replace("MBPS","Mbps"),a+=", <br/> Upload speeds up to "+c.up.replace("MBPS","Mbps")+"</b>",""!==c.displayName&&(m.myServices[0].serviceLevel=c.displayName),m.myServices[0].serviceDetail=a}}),m.hasMultipleDevices=1!==parseInt(e.internet.devices,10)}if(e.io){if(e.tv.serviceLevel||(e.tv.serviceLevel="Optimum TV"),m.myServices.push({serviceName:"TV",serviceLevel:e.tv.serviceLevel,serviceDetail:e.laBoxUser?"Includes free access to On Demand, the Optimum TV app and more":"Includes free access to On Demand, the Optimum app and more."}),e.isWestUser&&!e.laBoxUser)for(var b=0;b<m.myServices.length;b++)"TV"===m.myServices[b].serviceName&&(m.myServices[b].serviceDetail="Includes free access to On Demand and more.");m.hasMultipleBoxes=1!==parseInt(e.tv.box,10)}e.ov&&m.myServices.push({serviceName:"Phone",serviceLevel:"Optimum Phone",serviceDetail:"Reliable home phone service with advanced features."}),m.myServices.length>=1&&(m.activeServiceDrawer=m.myServices[0].serviceName)}},E=function(a){var b;return a.security&&"WEP"!==a.security.securityType&&(b=a.security.wpaPassphrase),b},F=function(){f.getRouterWirelessLan("").success(function(a){var b,c,d,e,f,g=!1;if(a.wirelessLan){if(b=a.wirelessLan.managedTogether,g=a.wirelessLan.connected){for(var h=0;h<a.wirelessLan.wirelessDevices.length;h++){var i=a.wirelessLan.wirelessDevices[h];i.wirelessNetwork&&i.wirelessNetwork.networkType&&"HOME"===i.wirelessNetwork.networkType&&i.radioSettings&&i.radioSettings.frequencyBandHz&&(24e8===i.radioSettings.frequencyBandHz?(c=i.wirelessNetwork.name,d=E(i.wirelessNetwork)):5e9===i.radioSettings.frequencyBandHz&&(e=i.wirelessNetwork.name,f=E(i.wirelessNetwork)))}m.accountInfo.wifiLAN.managedTogether=b,m.accountInfo.wifiLAN.name=c,m.accountInfo.wifiLAN.wpaPassphrase=d,m.accountInfo.wifiLAN.name_5Hz=e,m.accountInfo.wifiLAN.wpaPassphrase_5Hz=f,m.accountInfo.isWifiActive=!0}I()}}).error(function(a){m.accountInfo.isWifiActive=!1,console.log(a)})},G=function(){f.getNetworkMap("").success(function(a){if(void 0===a||void 0===a.routerData||null===a.routerData||"CURRENT"!==a.routerData.dataStatus)return console.log("retrieveNetworkMap empty response: "+a),void 0;var b=0;a.routerData.nodes.forEach(function(a){a&&!a.isMaster&&"air4920us-ac"===a.model.toLowerCase()&&b++}),m.accountInfo.wifiLAN.isXtendAvail=b}).error(function(a){console.log("retrieveNetworkMap error: "+a)})},H=function(){var a;e.internet&&(a=e.internet.equipModel);var b="/cdn/static.tvlistings.optimum.net/ool/static/prod/images/manage-router/";a&&(a.toLowerCase().indexOf("cablevision")>=0&&(a="Cablevision"),m.routerDevImg=b+a+".png")},I=function(){var a;e.internet&&(a=e.internet.equipModel),a&&f.getRouterFeaturesByModel(a).success(function(a){var b=a;console.log("cmsData : "+b),console.log("cmsData.deviceType : "+b.deviceType),b.deviceType&&(console.log("cmsData.deviceType : "+b.deviceType),m.accountInfo.wifiLAN.gateway=b.deviceType)}).error(function(){var a="Optimum Gateway not found";m.accountInfo.wifiLAN.gateway=a})},J=function(){m.phoneFooterShow=!0,m.phoneFooterUpsellShow=!1};m.changeServiceDetailsView=function(a){m.activeServiceDrawer=m.myServices[a].serviceName,"undefined"!==reporting&&reporting.trackClick(this,"Home| Home| Myservices "+m.myServices[a].serviceName)};var K=function(){m.accountInfo.isTV=e.io,m.accountInfo.isInternet=e.ool,e.internet&&e.internet.equipModel&&(m.accountInfo.hasManagedEquip=!0),m.accountInfo.isInternet&&m.accountInfo.hasManagedEquip&&(F(),H(),G())};return m.goToAlarmCom=j.goToAlarmCom,m.init=function(){n=d.getValuesBySelector("*"),m.loginAction=n.link.processLogin,m.loginReferer=window.location.href,m.basePhoneMenuUrl=n.link.basePhoneMenuUrl,m.alarmLink=n.link.alarmcomsso,b.ooluser=e,o=new f,A(),e.hasOOLSession&&(x(),D(),J(),K()),v(),m.displayAds=!0},m.init(),b.HomeCtrl=window.HomeCtrl=m}]);